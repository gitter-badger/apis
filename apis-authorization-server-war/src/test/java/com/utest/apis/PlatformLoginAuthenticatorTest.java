package com.utest.apis;

import java.io.ByteArrayInputStream;
import java.util.Collection;
import java.util.Map;

import junit.framework.Assert;

import org.junit.Test;
import org.w3c.dom.Document;

public class PlatformLoginAuthenticatorTest
{
	
	public static final String SUCCESSFUL_PLATFORM_RESPONSE = "<?xml version='1.0' encoding='UTF-8'?><ns1:UtestAuthenticationInfo xmlns:ns1='http://v4.model.webservice.utest.com' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='ns1:UtestAuthenticationInfo'><ns1:appKey xsi:nil='true'/><ns1:applicationFeatures><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>TM_HTML_COMPLETE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>ACCESS_SPUTNIK_IM_APPLICATION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>APPHANCE_INTEGRATION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>POSEIDON_DASHBOARD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>TM_TOP_TESTERS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>VOLTRON_DASHBOARD</ns2:string></ns1:applicationFeatures><ns1:authDate>2013-10-30T15:28:58.421Z</ns1:authDate><ns1:chatUUID>fb5dbaf3-f5ab-4251-9893-c9b76b6e6ac7</ns1:chatUUID><ns1:code>2d5c73b6cef77605edd426e73d103b691d9889adf9a61f79994d044d775a59905aff804f3aebc4356555b43c343b40ee85cf1a6ed24c595522aa7a42611ca238</ns1:code><ns1:grantedAuthorities><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_INFO_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_INFO_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_USERS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_USERS_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_FINANCE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PURCHASE_ORDERS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_BUG_TRACKING_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_BUG_TRACKING_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_INTERNAL_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_INTERNAL_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_BANNED_TESTERS_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_MANAGEMENT_COMPANY_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_MANAGEMENT_COMMUNITY_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_CREATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUGS_AND_TEST_CASES_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_CUSTOMER_NOTE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_SUBMIT_TO_TRACKING_SYSTEM</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_INIT_MESSAGE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_APPROVE_DISPUTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_FEEDBACK_DISPUTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_REQUEST_INFO</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_REJECT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_DISCARD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_DISPUTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_REJECT_DISPUTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_REFUSE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_ACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_CLONE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_LOCK</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_CLOSE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_DISCARD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_ADD_BONUS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_PRODUCT_DESCRIPTION_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_OBJECTIVES_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_COVERAGE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_TESTERS_SELECTION_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_CONTROL_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REPORT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_BUDGET_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>DATA_GRID_PM_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_MANAGEMENT_FINANCE_TESTER_PAYMENT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_MANAGEMENT_FINANCE_TESTER_BONUS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PROJECT_CREATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_WORK_VOLUME_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_DISCUSSION_THREAD_CREATION_STATUS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_IMPERSONATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TM_IMPERSONATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_PAYOUT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_DISCARDED_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_UNDER_REVIEW_REJECT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_UNDER_REVIEW_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_UNDER_REVIEW_FEEDBACK</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_UNDER_REVIEW_DISCARD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_LIST_EXPORT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_LIST_EXPORT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_BUG_RATES_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_PAYMENTS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_USER_ACCOUNT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_USER_ACCOUNT_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_NOT_CLOSED_BUG_RATES_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_DISCUSSION_THREAD_CREATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_CLIPBOARD_COPY</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_PROFIT_SUMMARY_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_COST_SUMMARY_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTERS_SECTION_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_FAVORITE_TESTERS_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_FAVORITE_TESTERS_EMAIL_COLUMN_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_IDENTITY_STATS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_IDENTITY_INTERNAL_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_COMPANY_SETTING_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_SET_IGNORE_LIMITS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_SELF_SERVE_TESTER_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_EXPRESS_BUILD_TEAM</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_EXPRESS_VIEW_ACTIONS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_EXPRESS_TC_DEACTIVTION_DATA_CONTROL</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_CONFIRM_TM</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_UPDATE_DECLINED_TESTER</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_DECLINE_REASONS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_TESTER_SELECTION_REMOVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_TEAM_SIZE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_PENDING</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_TESTER_ENVIRONMENT_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PURCHASE_ORDERS_CANCEL</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REVIEW_VOTING</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REVIEW_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REVIEW_TO_CSV_EXPORT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_MARKETING_FILE_UPLOAD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEAM_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEAM_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_FIRST_LOOK_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_AGENCY_COMPANY_FILTER_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_PENDING</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_PENDING_REVERT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEAM_LEADER_FOR_TEST_CYCLE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PRODUCT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PRODUCT_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_ACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_SUITE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_SUITE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_SUITE_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_SUITE_ACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_PLAN_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_PLAN_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_PLAN_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_PLAN_ACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_ACTIVATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_TEST_CASE_ASSIGN</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_ASSIGNMENT_EXECUTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_RESULT_APPROVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_ENVIRONMENT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_VERIFICATION_SUBMISSION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_TRACKING_ISSUE_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_TRACKING_ISSUE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_TRACKING_ISSUE_FIX_VERIFY</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_TESTER_SELECTION_UNREMOVE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_FIX_WORTHINESS_LEVEL_APPROVAL</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_MANAGEMENT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_PAYOUT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_PORTAL_EXPORT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_ADMIN_DASHBOARD_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PUBLIC_TEST_CYCLE_CREATE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_DIFF_USER_TEST_CASE_START_EXECUTION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_TAB_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_RATE_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_IDENTITY_RATING_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TM_ACCOUNT_DISABLE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_AUTO_CLOSE_DAYS_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_DEFAULT_BUG_APPROVAL_LEVEL_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REVIEW_RATES_EDIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_REVIEW_PAYOUT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_RESULT_APPROVAL_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CASE_SEARCH</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_RESULT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_RUN_RESULT_DISCARD</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_PENDING_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_FIX_WORTHINESS_LEVEL_OPTIONAL</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_BUG_EDIT_OTHERS</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PROJECT_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TTL_INSTRUCTIONS_VIEW</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TESTER_MESSENGER_INIT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_ADD_TTL_PAYMENT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TM_APPLICATION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TARGET_TEAM_EDIT'</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_INTERNAL_APPLICATION</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_MANAGEMENT</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_TEST_CYCLE_REVIEW_READ</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_VIEW_TESTER_PRIVATE_NOTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_EDIT_TESTER_PRIVATE_NOTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_REMOVE_TESTER_PRIVATE_NOTE</ns2:string><ns2:string xmlns:ns2='urn:org.apache.cxf.aegis.types'>PERMISSION_PRODUCT_VERSION_EDIT</ns2:string></ns1:grantedAuthorities><ns1:impsersonatedUserId xsi:nil='true'/><ns1:ipAddress>50.195.55.165</ns1:ipAddress><ns1:roles><ns2:int xmlns:ns2='urn:org.apache.cxf.aegis.types'>6</ns2:int><ns2:int xmlns:ns2='urn:org.apache.cxf.aegis.types'>13</ns2:int></ns1:roles><ns1:token>5e322f25-5a76-4d9f-80d9-dd2e39c15467</ns1:token><ns1:userId>77497</ns1:userId><ns1:userName>swellington@utest.com</ns1:userName></ns1:UtestAuthenticationInfo>";
	
	@Test
	public void testGetCode() throws Exception
	{
		PlatformLoginAuthenticator pla = new PlatformLoginAuthenticator();
		
		Document d = pla.parsePlatformResponse(new ByteArrayInputStream(SUCCESSFUL_PLATFORM_RESPONSE.getBytes("UTF-8")));
		
		String code = pla.getUserName(d);
		
		Assert.assertEquals("swellington@utest.com", code);
	}
	
	@Test
	public void testGetRoles() throws Exception
	{
		PlatformLoginAuthenticator pla = new PlatformLoginAuthenticator();
		
		Document d = pla.parsePlatformResponse(new ByteArrayInputStream(SUCCESSFUL_PLATFORM_RESPONSE.getBytes("UTF-8")));
		
		Collection<String> roles = pla.getRoles(d);
		
		Assert.assertNotNull(roles);
		Assert.assertEquals(2, roles.size());
		Assert.assertTrue(roles.contains("13"));
		Assert.assertTrue(roles.contains("6"));
	}
	
	@Test
	public void testGetAttributes() throws Exception
	{
		PlatformLoginAuthenticator pla = new PlatformLoginAuthenticator();
		
		Document d = pla.parsePlatformResponse(new ByteArrayInputStream(SUCCESSFUL_PLATFORM_RESPONSE.getBytes("UTF-8")));
		
		Map<String, String> attributes = pla.getAttributes(d);
		
		Assert.assertNotNull(attributes);
		Assert.assertEquals(7, attributes.size());
		Assert.assertNull(attributes.get("appKey"));
		Assert.assertEquals("2013-10-30T15:28:58.421Z", attributes.get("authDate"));
		Assert.assertEquals("fb5dbaf3-f5ab-4251-9893-c9b76b6e6ac7", attributes.get("chatUUID"));
		Assert.assertEquals("2d5c73b6cef77605edd426e73d103b691d9889adf9a61f79994d044d775a59905aff804f3aebc4356555b43c343b40ee85cf1a6ed24c595522aa7a42611ca238", attributes.get("code"));
		Assert.assertNull(attributes.get("impsersonatedUserId"));
		Assert.assertEquals("50.195.55.165", attributes.get("ipAddress"));
		Assert.assertEquals("5e322f25-5a76-4d9f-80d9-dd2e39c15467", attributes.get("token"));
		Assert.assertEquals("77497", attributes.get("userId"));
		Assert.assertEquals("TM_HTML_COMPLETE,ACCESS_SPUTNIK_IM_APPLICATION,APPHANCE_INTEGRATION,POSEIDON_DASHBOARD,TM_TOP_TESTERS,VOLTRON_DASHBOARD", attributes.get("applicationFeatures"));
	}
}
